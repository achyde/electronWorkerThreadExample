{"version":3,"sources":["../../electron/main/index.ts"],"sourcesContent":["process.env.DIST_ELECTRON = join(__dirname, '..')\nprocess.env.DIST = join(process.env.DIST_ELECTRON, '../dist')\nprocess.env.PUBLIC = app.isPackaged ? process.env.DIST : join(process.env.DIST_ELECTRON, '../public')\n\nimport {app, BrowserWindow, ipcMain} from 'electron'\nimport {join} from 'path';\nimport {Worker} from 'worker_threads';\n\nlet win: BrowserWindow | null = null\nconst url = process.env.VITE_DEV_SERVER_URL as string\nconst indexHtml = join(process.env.DIST, 'index.html')\n\nlet testLog = \"\";\n\nconst log_test_status = (s: string) => {\n    win.webContents.send(\"test_status\", s);\n    testLog += `${s}\\n`;\n}\n\nconst log_julian_time = (s: string) => win.webContents.send(\"julian_time\", s)\nconst log_past_messages = () => win.webContents.send(\"get_log\", testLog)\n\nlet worker = null;\n\nconst terminate_worker = async () => {\n    if (worker) {\n        await worker.terminate();\n        worker = null;\n    }\n};\n\nconst stopTest = async () => {\n    log_test_status(\"Stopping test.\");\n    await terminate_worker();\n};\n\nconst runTest = (workerData) => {\n    return new Promise((resolve, reject) => {\n\n        worker = new Worker(`${__dirname}/testRunner.js`, {workerData});\n\n        worker.on('message', (e) => {\n            if (e.msg) {\n                log_test_status(e.msg);\n            }\n            if (e.julian_time) {\n                log_julian_time(e.julian_time);\n            }\n        });\n        worker.on('close', () => stopTest().then(() => resolve({done: true})));\n        worker.on('error', reject);\n        worker.on('exit', (code: number) => {\n            if (code !== 0){\n                reject(new Error(`Worker stopped with exit code ${code}`));\n            }\n            else{\n                resolve({done: true});\n            }\n        });\n    });\n}\n\nconst createWindow = async () => {\n\n    win = new BrowserWindow({title: 'Main window', webPreferences: {preload: join(__dirname, '../preload/index.js')}});\n\n    if (app.isPackaged) {\n        win.loadFile(indexHtml);\n    } else {\n        win.loadURL(url);\n        win.maximize();\n    }\n\n    ipcMain.on(\"clear_log\", () => testLog = \"\");\n    ipcMain.on(\"get_log\",  () => log_past_messages());\n    ipcMain.on(\"stop_test\", () => stopTest());\n    ipcMain.on(\"start_test\", async (event, args) => await runTest({runs: args.runs, steps: args.steps}).finally(() => log_test_status(\"Test done.\")));\n};\n\napp.on(\"ready\", createWindow);"],"mappings":"AAIA,sBAA0C;AAC1C,kBAAmB;AACnB,4BAAqB;AANrB,QAAQ,IAAI,oBAAgB,kBAAK,WAAW,IAAI;AAChD,QAAQ,IAAI,WAAO,kBAAK,QAAQ,IAAI,eAAe,SAAS;AAC5D,QAAQ,IAAI,SAAS,oBAAI,aAAa,QAAQ,IAAI,WAAO,kBAAK,QAAQ,IAAI,eAAe,WAAW;AAMpG,IAAI,MAA4B;AAChC,MAAM,MAAM,QAAQ,IAAI;AACxB,MAAM,gBAAY,kBAAK,QAAQ,IAAI,MAAM,YAAY;AAErD,IAAI,UAAU;AAEd,MAAM,kBAAkB,CAAC,MAAc;AACnC,MAAI,YAAY,KAAK,eAAe,CAAC;AACrC,aAAW,GAAG;AAAA;AAClB;AAEA,MAAM,kBAAkB,CAAC,MAAc,IAAI,YAAY,KAAK,eAAe,CAAC;AAC5E,MAAM,oBAAoB,MAAM,IAAI,YAAY,KAAK,WAAW,OAAO;AAEvE,IAAI,SAAS;AAEb,MAAM,mBAAmB,YAAY;AACjC,MAAI,QAAQ;AACR,UAAM,OAAO,UAAU;AACvB,aAAS;AAAA,EACb;AACJ;AAEA,MAAM,WAAW,YAAY;AACzB,kBAAgB,gBAAgB;AAChC,QAAM,iBAAiB;AAC3B;AAEA,MAAM,UAAU,CAAC,eAAe;AAC5B,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AAEpC,aAAS,IAAI,6BAAO,GAAG,2BAA2B,EAAC,WAAU,CAAC;AAE9D,WAAO,GAAG,WAAW,CAAC,MAAM;AACxB,UAAI,EAAE,KAAK;AACP,wBAAgB,EAAE,GAAG;AAAA,MACzB;AACA,UAAI,EAAE,aAAa;AACf,wBAAgB,EAAE,WAAW;AAAA,MACjC;AAAA,IACJ,CAAC;AACD,WAAO,GAAG,SAAS,MAAM,SAAS,EAAE,KAAK,MAAM,QAAQ,EAAC,MAAM,KAAI,CAAC,CAAC,CAAC;AACrE,WAAO,GAAG,SAAS,MAAM;AACzB,WAAO,GAAG,QAAQ,CAAC,SAAiB;AAChC,UAAI,SAAS,GAAE;AACX,eAAO,IAAI,MAAM,iCAAiC,MAAM,CAAC;AAAA,MAC7D,OACI;AACA,gBAAQ,EAAC,MAAM,KAAI,CAAC;AAAA,MACxB;AAAA,IACJ,CAAC;AAAA,EACL,CAAC;AACL;AAEA,MAAM,eAAe,YAAY;AAE7B,QAAM,IAAI,8BAAc,EAAC,OAAO,eAAe,gBAAgB,EAAC,aAAS,kBAAK,WAAW,qBAAqB,EAAC,EAAC,CAAC;AAEjH,MAAI,oBAAI,YAAY;AAChB,QAAI,SAAS,SAAS;AAAA,EAC1B,OAAO;AACH,QAAI,QAAQ,GAAG;AACf,QAAI,SAAS;AAAA,EACjB;AAEA,0BAAQ,GAAG,aAAa,MAAM,UAAU,EAAE;AAC1C,0BAAQ,GAAG,WAAY,MAAM,kBAAkB,CAAC;AAChD,0BAAQ,GAAG,aAAa,MAAM,SAAS,CAAC;AACxC,0BAAQ,GAAG,cAAc,OAAO,OAAO,SAAS,MAAM,QAAQ,EAAC,MAAM,KAAK,MAAM,OAAO,KAAK,MAAK,CAAC,EAAE,QAAQ,MAAM,gBAAgB,YAAY,CAAC,CAAC;AACpJ;AAEA,oBAAI,GAAG,SAAS,YAAY;","names":[],"file":"index.js"}